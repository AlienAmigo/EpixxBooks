!function(e){var t={};function n(r){if(t[r])return t[r].exports;var c=t[r]={i:r,l:!1,exports:{}};return e[r].call(c.exports,c,c.exports,n),c.l=!0,c.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var c in e)n.d(r,c,function(t){return e[t]}.bind(null,c));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/js",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var r=()=>{let e=[];localStorage.getItem("my-cart")&&(e=JSON.parse(localStorage.getItem("my-cart")));document.querySelector(".page-header__cart-num");const t=e=>{let t=document.querySelector(".page-header__cart-num"),n=0;e.length&&e.forEach(e=>{n+=e.qty}),t.textContent=n};t(e);const n=n=>{(async()=>{await fetch(r).then(e=>e.json()).then(r=>{const c=r.filter(e=>e.uri==n),o=e.findIndex(e=>e.uri===n);-1===o?e.push({...c[0],qty:1}):e[o].qty+=1,(e=>{localStorage.setItem("my-cart",JSON.stringify(e)),t(e)})(e),t(e)}).catch(e=>{console.log(e)})})()},r="/data/data.json";let c=2,o=8,a=document.querySelector(".catalog__books-list"),l=document.querySelector(".tmp-book-card");function i(e){let t=l.content.cloneNode(!0);return e.hasOwnProperty("new")&&1==e.new||t.querySelector(".card__new").parentElement.removeChild(t.querySelector(".card__new")),t.querySelector(".card").dataset.id=`${e.uri}`,t.querySelector(".card__inner").href=`index.html#${e.uri}`,t.querySelector(".card__img").src=`/img/books/${e.uri}.jpg`,t.querySelector(".card__img").alt=e.name,t.querySelector(".card__title").textContent=e.name,t.querySelector(".card__price").textContent=convRUB(e.price),t}const u=document.querySelector("[data-catalog]");u&&u.addEventListener("click",e=>{const{target:t}=e,r=t.closest(".card"),c=r.dataset.id,o=r.querySelector(".card__buy"),a=r.querySelector(".card__buy span");console.log(t),r&&t!=o&&t!=a?_(c):r&&n(c)});const d=document.querySelector(".popular__slider");d&&d.addEventListener("click",e=>{const{target:t}=e,r=t.closest(".card"),c=r.dataset.id,o=r.querySelector(".card__buy"),a=r.querySelector(".card__buy span");console.log(t),r&&t!=o&&t!=a?_(c):r&&n(c)}),a&&function(){for(let e=0;e<o;e++)(async()=>{await fetch(r).then(e=>e.json()).then(t=>{let n=o*(c-1)+e;n<t.length-1&&a.appendChild(i(t[n]))}).catch(e=>{console.log(e)})})()}();let s=document.querySelector("#filters"),p=document.querySelector("#filters-trigger");s&&p&&p.addEventListener("click",(function(){s.classList.toggle("filters--open")}));let m=document.querySelector("#modal-book-view"),g=document.querySelector(".modal__dialog"),y=document.querySelector(".modal__close");function _(e){(async()=>{await fetch(r).then(e=>e.json()).then(t=>{let r=t.find(t=>t.uri==e);m.querySelector(".product__img-wrap img").src=`/img/books/${r.uri}.jpg`,m.querySelector(".product__img-wrap img").alt=r.name,m.querySelector(".product__title").textContent=r.name,m.querySelector(".product__descr").querySelector("p").textContent=r.desc;const c=m.querySelector(".btn--price");c.innerHTML=convRUB(r.price)+'                      <span class="btn__sm-text">\n                        <svg class="btn__icon" width="14" height="14">\n                          <use xlink:href="#plus"></use>\n                        </svg>\n                        <span>В корзину</span>',c.addEventListener("click",(function(){n(e)})),m.classList.add("modal--open")}).catch(e=>{console.log(e)})})()}function f(){m.classList.remove("modal--open")}g&&g.addEventListener("click",(function(e){e.stopPropagation()})),m&&y&&(m.addEventListener("click",f),y.addEventListener("click",f))};var c=()=>{};var o=()=>{document.querySelector("#popular-slider")&&new Glide("#popular-slider",{type:"carousel",focusAt:"center",perView:4}).mount()};var a,l=()=>{const e={popUp:null,trigger:null,popupClose:null,isActive:!1,init(e){this.popUp=document.querySelector(".popup"),this.popUpWindow=document.querySelector(".popup-body");const t=this;this.popUp.addEventListener("click",(function(e){t.close(e)})),this.popUpWindow.addEventListener("click",(function(e){e.stopPropagation()})),this.popUpClose=document.querySelector(".popup-close"),this.popUpClose.addEventListener("click",(function(e){t.close(e)})),e&&(this.trigger=e,this.trigger.addEventListener("click",(function(e){t.open(e,popupHTML)}))),window.addEventListener("keyup",(function(e){"Escape"===e.key&&t.close()}),!0)},open(e,t){t&&(this.popUp.querySelector(".popup-inner").innerHTML=t),this.popUp.style.display="block",this.isActive=!0},close(){console.log(this.popUp),this.popUp.style.display="none",this.isActive=!1},reset(){this.popUp=null,this.trigger.removeEventListener("click",this.open),this.trigger=null}};document.querySelector(".popup")&&e.init();let t=[];localStorage.getItem("my-cart")&&(t=JSON.parse(localStorage.getItem("my-cart")));const n=e=>{let t=document.querySelector(".page-header__cart-num"),n=0;e.length&&e.forEach(e=>{n+=e.qty}),t.textContent=n},r={wrongQty:"Можно заказать только от 1 до 10 единиц одного товара",wrongQtyFiledVal:"Нужно ввести число"};let c=document.querySelector(".cart__table"),o=g(".field-num__btn-plus"),a=g(".field-num__btn-minus"),l=g(".cart__product-del-btn"),i=g(".field-num__input"),u=g(".cart__item-price"),d=document.querySelector(".cart__products-price-num"),s=document.querySelector(".checkout__price");function p(t){e.open("",t)}function m(e){let t=0;return e.forEach(e=>{t+=e.price*e.qty}),t}function g(e){return[].slice.apply(document.querySelectorAll(e))}function y(e){c.innerHTML="";let h=document.createDocumentFragment();h.append(document.querySelector(".tmp__table-header").content.cloneNode(!0)),e.length&&e.forEach(e=>{h.append(function(e){let t=document.querySelector(".tmp__card-row").content.cloneNode(!0);return e.totalItemPrice=e.price*e.qty,t.querySelector(".cart__product").dataset.id=e.uri,t.querySelector(".cart__item-name").textContent=e.name,t.querySelector(".cart__item-img").src=`/img/books/${e.uri}.jpg`,t.querySelector(".cart__item-img").alt=e.uri,t.querySelector(".cart__item-price").textContent=convRUB(e.totalItemPrice),t.querySelector(".field-num__input").value=e.qty,t}(e))}),h.append(function(e){let t=document.querySelector(".tmp__table-footer").content.cloneNode(!0);return t.querySelector(".cart__products-price-num").textContent=convRUB(e),t}(m(t))),s.textContent=convRUB(m(t)),c.append(h),_(),n(e),o=g(".field-num__btn-plus"),a=g(".field-num__btn-minus"),l=g(".cart__product-del-btn"),i=g(".field-num__input"),u=g(".cart__item-price"),d=document.querySelector(".cart__products-price-num"),o.forEach((e,n)=>{e.addEventListener("click",(function(){f(n,t[n].qty+1)}))}),a.forEach((e,n)=>{e.addEventListener("click",(function(){f(n,t[n].qty-1)}))}),l.forEach((e,r)=>{e.addEventListener("click",(function(){var e;e=r,t.splice(e,1),localStorage.setItem("my-cart",JSON.stringify(t)),n(t),y(t)}))}),i.forEach((e,n)=>{e.addEventListener("change",(function(){var c,o;c=n,(o=e.value).trim().match(/[\d]+/g)?f(c,o):(i[c].value=t[c].qty,p(r.wrongQtyFiledVal)),i[c].value=t[c].qty}))})}function _(e=function(e){let t=0;return e.forEach(e=>{t+=e.qty}),t}(t)){let n="ов";switch(e%10){case 1:if(e%100==11)break;n="";break;case 2:if(e%100==12)break;case 3:if(e%100==13)break;case 4:if(e%100==14)break;n="а"}0==e&&(e="нет"),document.querySelector(".cart__title").textContent=`В корзине ${e} товар${n}`}function f(e,c){c>=1&&c<=10?(i[e].value=+c,t[e].qty=+c,localStorage.setItem("my-cart",JSON.stringify(t)),t[e].totalItemPrice=t[e].qty*t[e].price,u[e].textContent=convRUB(t[e].totalItemPrice),_(),n(t),d.textContent=convRUB(m(t)),s.textContent=convRUB(m(t))):p(r.wrongQty)}c&&y(t);let h=document.querySelector(".cart__clear-btn");h&&h.addEventListener("click",(function(){t=[],localStorage.clear("my-cart"),y(t)}));const S=[{name:"firstname",obj:document.querySelector('input[name="firstname"]'),regExp:new RegExp(/^[А-Яа-яЁёA-Za-z]+$/gim),msg:"Нужно ввести корректное имя"},{name:"lastname",obj:document.querySelector('input[name="lastname"]'),regExp:new RegExp(/^[А-Яа-яЁёA-Za-z]+$/gim),msg:"Нужно ввести корректную фамилию"},{name:"phone",obj:document.querySelector('input[type="tel"]'),regExp:new RegExp(/(\+?\s?(\d)\s?\(?(\d{3})\)?\s?(\d{3})\s?\-?\s?(\d{2})\s?\-?\s?(\d{2}))/gim),msg:"Нужно ввести корректный номер телефона"},{name:"email",obj:document.querySelector('input[type="email"]'),regExp:new RegExp(/\b[\w\-\.$]+@[\w\-\.]+\.[a-z]{1,3}\b/gim),msg:"Нужно ввести корректный адрес электронной почты"}];let v="field-text--input-checked";const q=document.querySelector(".form");if(q){q.addEventListener("submit",e=>{e.preventDefault()});const e=document.querySelector(".cart");e.addEventListener("change",e=>{b(e)}),e.addEventListener("focus",e=>{b(e)}),e.addEventListener("blur",e=>{b(e)})}function b(e){const{target:t}=e,n=S.find(e=>t.name==e.name);console.log(e+" : "+t.name),n&&function(e,t,n,r){let c=e.value.trim(),o=e.parentElement;c.match(t)?o.classList.add(n):(o.classList.remove(n),p(r))}(n.obj,n.regExp,v,n.msg)}};a=function(){function e(e){return"ru"==e?'<span class="field-select__lang-ru"></span>':"en"==e?'<span class="field-select__lang-en"></span>':'<span class="field-select__lang-null"></span>'}if(c(),window.convRUB=function(e,t="₽"){let n=e.toString();if(n.match(/\d{4,}/g))for(;n.replace(/(\d+)(\d{3}(\s\d{3})*$)/g,"$1 $2")!=n;)n=n.replace(/(\d+)(\d{3}(\s\d{3})*$)/g,"$1 $2");return null!=t&&t.length&&!t.match([/^[\s]+$/g])&&(n=`${n} ${t.trim()}`),n},r(),o(),l(),new Choices(".field-select:not(#lang) select.field-select__select",{searchEnabled:!1,shouldSort:!1}),new Choices("#lang select.field-select__select",{searchEnabled:!1,shouldSort:!1,callbackOnCreateTemplates:function(t){return{item:(n,r)=>t(`\n            <div class="${n.item} ${r.highlighted?n.highlightedState:n.itemSelectable}" data-item data-id="${r.id}" data-value="${r.value}" ${r.active?'aria-selected="true"':""} ${r.disabled?'aria-disabled="true"':""}>\n              ${e(r.value)} ${r.label.substr(0,3)}\n            </div>\n          `),choice:(n,r)=>t(`\n            <div class="${n.item} ${n.itemChoice} ${r.disabled?n.itemDisabled:n.itemSelectable}" data-select-text="${this.config.itemSelectText}" data-choice ${r.disabled?'data-choice-disabled aria-disabled="true"':"data-choice-selectable"} data-id="${r.id}" data-value="${r.value}" ${r.groupId>0?'role="treeitem"':'role="option"'}>\n              ${e(r.value)} ${r.label}\n            </div>\n          `)}}}),document.getElementById("price-range")){var t=document.getElementById("price-range");noUiSlider.create(t,{start:[400,1e3],connect:!0,step:100,range:{min:200,max:2e3}})}},(document.attachEvent?"complete"===document.readyState:"loading"!==document.readyState)?a():document.addEventListener("DOMContentLoaded",a)}]);